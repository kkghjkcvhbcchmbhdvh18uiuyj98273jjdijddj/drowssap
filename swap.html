<script>
function escapeRegExp(string) {
  return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // $& means the whole matched string
}
function replaceAll(str, find, replaces) {
  return str.replace(new RegExp(escapeRegExp(find), 'g'), replaces);
}

function getQ(variable)
{ 
  var query = window.location.search.substring(1); 
  query = replaceAll(query,'%20',' ');
var vars = query.split("&"); 
  for (var i=0;i<vars.length;i++)
  { 
    var pair = vars[i].split("="); 
    if (pair[0] == variable)
    { 
      return pair[1].replace(/_bel_/g, "&nbsp;").replace(/_br_/g, "<br>");
    } 
  }
  return 'N/A'; //not found 
}


function setAccountInfo() {
	string = "";
	vals = "";
	var query = window.location.search.substring(1); 
        query = replaceAll(query,'%20',' ');
	var vars = query.split("&"); 
	
	for(let i = 0; i<vars.length; i++) {
	
	var s = vars[i].split('=');
	string += '@bel@' + s[0];
	vals += '@bel@' + s[1];
	}
	ins = string.split("@bel@");
	inx = vals.split("@bel@");
	for(let i = 1; i<ins.length; i++) {
	localStorage.setItem('user_' + ins[i],inx[i]);
	}
	localStorage.setItem('user_keys',string);
        np = localStorage.getItem('user_fullname').split(" ");
        localStorage.setItem('user',np[0]);
}


function setTrackingInfo() {
	
	localStorage.setItem('user_cart',localStorage.getItem('cartlist'));
}

function buying() {

payfast = `<div id="payfast" style="display:none;"><form name="PayFastPayNowForm" action="https://www.payfast.co.za/eng/process" method="post">  <input required type="hidden" name="cmd" value="_paynow">  <input required type="hidden" name="receiver" pattern="[0-9]" value="19754082">  <input type="hidden" name="return_url" value="http://request.bleedingedgelab.co.za/man.php?ref=buy&status=success">  <input type="hidden" name="cancel_url" value="http://request.bleedingedgelab.co.za/man.php?ref=buy&status=cancel">  <input required type="hidden" name="amount" value="` + localStorage.getItem('total') + `" id="injtotal">  <input required type="hidden" name="item_name" maxlength="255" value="Bleeding Edge Lab (PTY) Ltd - Checkout">  <input type="hidden" name="item_description" maxlength="255" value="Checkout item(s) from Bleeding Edge Lab (PTY) Ltd">  <table>  <tr>  <td colspan=2 align=center>  <input type="image" src="https://www.payfast.co.za/images/buttons/PayNow/Dark-Large-Square-PayNow.png" alt="Pay Now" title="Pay Now with PayFast" id="payfastgo">  </td>  </tr>  </table>  </form></div>`;

document.body.innerHTML = payfast;
document.querySelector('#payfastgo').click();
}


switch(getQ('ref')) {
case "login":
if(getQ('status')=="success") {
setAccountInfo();
if(getQ('do')=="buying") {
if(localStorage.getItem('total')=="0.00" || !localStorage.getItem('total'))
{  location.replace('https://bleedingedgelab.co.za/?notify=The%20Cart%20is%20empty.'); } else 
{ buying(); }

 } else {
location.replace('https://bleedingedgelab.co.za/Account'); }
 }
else if(getQ('status')=="false") { 
location.replace('https://bleedingedgelab.co.za/Login?notify=The%20entered%20Login%20details%20are%20incorrect.');
 }
break;
case "tracking":
setTrackingInfo();
//location.replace('http://request.bleedingedgelab.co.za/man.php?email=' + localStorage.getItem('user_email') + '&ref=cart&cart=' + localStorage.getItem('user_cart')); 
document.write(`<form action="http://request.bleedingedgelab.co.za/man.php" method="post" id="cartform"><input type="hidden" name="email" value="`+localStorage.getItem('user_email')+`"><textarea name="cart">`+localStorage.getItem('user_cart')+`</textarea><input type="hidden" name="ref" value="cart"></form>`);
document.querySelector('#cartform').submit();
break;
default:
location.replace('https://bleedingedgelab.co.za/'); 
break;
}

//location.replace();
</script>
<style>
#cartform {display:none;}
</style>